% Parameters
%
% 1: dimension (in cm)
% 2: board size (square)
% 
% Example: A 19x19 board with size 10cm x 10cm: `\calculateStep{10}{19}`
\newcommand{\calculateStep}[2]{
  \pgfmathsetmacro{\step}{#1 / (#2 - 1)} % chktex 1
}

\newif\ifcoords
\newif\ifcoordsTop
\newif\ifcoordsRight
\newif\ifcoordsBottom
\newif\ifcoordsLeft

% From [this answer by @UlrichDiez](https://tex.stackexchange.com/a/709341/64441).
\pgfkeys{%
  %---------------------------------------------------------
  /phili/goGrid/.cd, 
    board dimension/.store in    = \boardDimension,
    board dimension              = 10cm,
    board size/.store in         = \boardSize,
    board size                   = 19,
    outline line width/.store in = \boardOutlineWidth,
    outline line width           = 0.7mm,
    coords/.is if                = coords,
    coords                       = true,
    coords top/.is if            = coordsTop,
    coords top                   = true,
    coords right/.is if          = coordsRight,
    coords right                 = true,
    coords bottom/.is if         = coordsBottom,
    coords bottom                = true,
    coords left/.is if           = coordsLeft,
    coords left                  = true,
    coords font/.store in        = \coordsFont,
    coords font                  = ,
    coords font size/.store in   = \coordsFontSize,
    coords font size             = 10pt,
  %---------------------------------------------------------
  /phili/goban/.search also={/phili/goGrid},
  /phili/goban/.cd,  
    scale/.store in              = \scale,
    scale                        = 1,
  %---------------------------------------------------------
}

% Parameters
%
% - board dimension (in cm)
% - board size (square)
% 
% Example: A 19x19 board with size 10cm x 10cm:
%
% ```tex
% \goGrid[board dimension = 10,
%         board size      = 9]
% ```
\newcommand{\goGrid}[1][]{
  \pgfkeys{/phili/goGrid/.cd, #1}

  \calculateStep{\boardDimension}{\boardSize}

  \draw[step=\step] (0, 0) grid
    (\boardDimension, \boardDimension);
  
  \boardOutline{\boardDimension}
  
  \ifcoords
    \coordinates{\boardDimension}{\boardSize}{\step}
  \fi

  \drawHoshis
}

% Reference: [Drawing a Non-Jagged Grid Outline](https://tex.stackexchange.com/q/709298/64441)
%
% Parameters
%
% 1: dimension (in cm)
% 
% Example: `\boardOutline{10}`
\newcommand{\boardOutline}[1]{
  \draw[step       = #1,
        line width = \boardOutlineWidth,
        line cap   = rect] 
    (0, 0) grid (#1, #1);
}

\newcounter{coordinateCounter}
\setcounter{coordinateCounter}{1}
% Parameters
%
% 1: dimension (in cm)
% 2: board size (square)
% 3: step
% 
% Example: A 19x19 board with size 10cm x 10cm: `\coordinates{10}{19}{\step}`
\newcommand{\coordinates}[3]{
  \pgfmathsetmacro{\leftRightShift}{1.9 * (\step cm / 2)}
  \pgfmathsetmacro{\topBottomShift}{1.8 * (\step cm / 2)}
  
  \def\customFont{\fontsize{\coordsFontSize}{5pt} \coordsFont}

  \foreach [count=\i] \l in {A, B, ..., Z} {
    \ifthenelse{\equal{\l}{I} \OR \i > \numexpr #2 + 1 \relax}{}{
      \pgfmathsetmacro{\coordinateShiftVertical}{
         \step cm * (\thecoordinateCounter - 1)
      }
      \pgfmathsetmacro{\coordinateShiftHorizontal}{
         \step cm * (\thecoordinateCounter - 1) - 1pt
      }

      \ifcoordsTop
        \draw[
          xshift = \coordinateShiftHorizontal,
          yshift = #1cm + \topBottomShift,
          font   = \customFont,
        ] node {\l};
      \fi
      \ifcoordsRight
        \draw[
          xshift = #1cm + \leftRightShift,
          yshift = \coordinateShiftVertical,
          font   = \customFont,
        ] node {\thecoordinateCounter};
      \fi
      \ifcoordsBottom
        \draw[
          xshift = \coordinateShiftHorizontal,
          yshift = -\leftRightShift,
          font   = \customFont,
        ] node {\l};
      \fi
      \ifcoordsLeft
        \draw[
          xshift = -\leftRightShift,
          yshift = \coordinateShiftVertical,
          font   = \customFont,
        ] node {\thecoordinateCounter};
      \fi

      \stepcounter{coordinateCounter}
    }
  }
  \setcounter{coordinateCounter}{1}
}

% Parameters
%
% 1: dimension (in cm)
% 2: board size (square)
% 3: step
% 
% Example: A 19x19 board with size 10cm x 10cm: `\drawHoshis{10}{19}{\step}`
\newcommand{\drawHoshis}{
  \tikzmath{
    \hoshiRadius = \step * 0.125;
    %
    \centerHoshi = ceil(\boardSize / 2);
    %
    int \hoshiDistance;
    if \boardSize<12 then {
      \hoshiDistance = 3;
    } else {
      \hoshiDistance = 4;
    };
    %
    \hoshiComplement = \boardSize - \hoshiDistance + 1;
  }

  \drawCenterHoshi
  \drawCornerHoshis
  \ifnum\boardSize>6\relax
    \drawCornerHoshis
  \fi
  \ifthenelse{\isodd{\boardSize}}{
    \ifnum\boardSize>13\relax
      \drawSideHoshis
    \fi
  }{}
}

\newcommand{\drawCenterHoshi}{
  \pgfmathsetmacro{\centerHoshiCoord}{(\centerHoshi - 1) * \step}

  \filldraw (\centerHoshiCoord, \centerHoshiCoord)
    circle [radius=\hoshiRadius];
}

\newcommand{\drawCornerHoshis}{
  \def\cornerHoshiArray{%
    {\hoshiDistance, \hoshiDistance},%
    {\hoshiComplement, \hoshiDistance},%
    {\hoshiDistance, \hoshiComplement },%
    {\hoshiComplement, \hoshiComplement}%
  }

  \foreach \sloc in \cornerHoshiArray {
    \pgfmathsetmacro{\hoshiCoordX}{\step * ({\sloc}[0] - 1)}
    \pgfmathsetmacro{\hoshiCoordY}{\step * ({\sloc}[1] - 1)}

    \filldraw (\hoshiCoordX, \hoshiCoordY)
      circle [radius=\hoshiRadius];
  }
}

\newcommand{\drawSideHoshis}{
  \def\sideHoshiArray{%
    {\hoshiDistance, \centerHoshi},%
    {\centerHoshi, \hoshiComplement},%
    {\centerHoshi, \hoshiDistance},%
    {\hoshiComplement, \centerHoshi}%
  }    

  \foreach \sloc in \sideHoshiArray {
    \pgfmathsetmacro{\hoshiCoordX}{\step * ({\sloc}[0] - 1)}
    \pgfmathsetmacro{\hoshiCoordY}{\step * ({\sloc}[1] - 1)}

    \filldraw (\hoshiCoordX, \hoshiCoordY)
      circle [radius=\hoshiRadius];
  }
}